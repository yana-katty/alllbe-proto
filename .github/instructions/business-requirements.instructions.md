---
applyTo: "**"
---

# ビジネス要件指示書: Alllbe Location Based Entertainment プラットフォーム

## プロジェクト概要

### プロジェクト名
**Alllbe** - 「全ての人がコンテンツを体験して All will be (happy/scared/excited/inspired) な状態になる」ことと、「全ての Location Based Entertainment を集約させる」ことを表現

### 目的
日本向け小～中規模の Location Based Entertainment (LBE) の B2B2C Experience 予約プラットフォームを構築。個人から中小企業が運営するイベント・展示に特化し、「展示に来る前も来た後も楽しい」をコンセプトとした Enterprise Ready なプラットフォーム。

### ターゲット市場
- **主催者**: 個人クリエイター、中小企業、アーティスト、展示運営者
- **参加者**: LBE体験を求める一般ユーザー
- **市場**: 日本国内の小～中規模 Location Based Entertainment 市場

### ビジョン・戦略的必須要件

#### 1. 「After（イベント後）」への徹底的なこだわり
イベント後の Experience Circle こそが、このプラットフォームのキラーフィーチャー。この機能は、クラス最高で、最も直感的で、最も価値のある部分でなければならない。競争の勝敗はここで決まる。

**重要**: Experience Circle は体験後のコンテンツアクセスを通して参加者の気持ち的な繋がりとリテンションを生み出し、次回の集客につながる自己強化サイクルの核心機能である。

#### 2. アーティストの「味方」であること
UIデザインから価格設定に至るまで、すべての製品決定は「これはアーティストの生活を楽にし、彼らのキャリアをより持続可能にするか？」というレンズを通して見られなければならない。

#### 3. 完璧な市場投入を実行すること
初期のハイタッチなフェーズは、交渉の余地なく必須。最初の100人のクリエイターと共に強固な基盤を築くことが、事業全体の軌道を決定づける。

#### 4. フライホイールの構築
単なるファネルではなく、エンゲージメントの高い参加者がファンになり、ファンがコミュニティメンバーになり、成功したクリエイターがさらに多くのクリエイターを惹きつける、自己持続的なエコシステムを創造する。

## 主要機能要件

### 1. Organization & Enterprise 管理
- **Enterprise Ready 設計**: WorkOS を活用した SSO 対応・厳格な従業員ログイン管理
- **Organization 管理**: 企業・団体が Organization エンティティを管理
- **権限管理**: Organization 配下の管理側ユーザーの所属・権限設定
- **Multi-tenant アーキテクチャ**: 各 Organization の独立したデータ管理

### 2. Experience 管理（コンテンツの核）
- **Experience 作成**: タイトル、説明、場所、料金、体験タイプの設定
- **多様な体験タイプ**: 
  - 日時指定型（特定の時間に開催）
  - 期間指定型（期間中いつでも入場可能）
  - 拡張可能な体験タイプ設計
- **Experience CMS**: Organization 向けの直感的なコンテンツ管理システム
- **ライフサイクル管理**: 下書き→公開→終了→アーカイブ

### 3. ユーザー管理・認証システム
- **二重アカウント設計**: 
  - **エンドユーザー**: Auth0 による認証、プラットフォーム一意の ID、Experience 予約・体験管理
  - **Organization 管理ユーザー**: WorkOS 経由の SSO、Experience 運営権限
- **体験履歴管理**: ユーザーの体験済みコンテンツ・今後の予約管理
- **プライバシー重視**: GDPR 準拠のユーザーデータ管理

### 4. 予約・決済システム
- **柔軟な予約システム**: 体験タイプに応じた予約フロー
- **決済処理**: 日本市場向けの多様な決済手段対応
- **キャンセル・返金**: 体験タイプ別のキャンセルポリシー
- **QR コード入場**: Organization の端末での入場管理・来歴記録

### 5. 関連コンテンツ・コミュニティシステム（キラーフィーチャー）
- **Before/After コンテンツ**: 
  - 動画、記事（体験ガイド、インタビュー）
  - アートワーク集、ダウンロードコンテンツ
  - 将来的な拡張性を考慮した設計
- **アクセス権限管理**: 
  - Public（誰でも閲覧可能）
  - チケット購入済み（予約者のみ）
  - 体験済み（実際に体験した人のみ）
  - 拡張可能な権限設定
- **Experience Circle**: 体験後のコンテンツアクセスによるリテンション促進
  - **After コンテンツ体験**: 体験済み参加者限定の特別コンテンツアクセス
  - **気持ち的な繋がり**: コンテンツを通した Experience・クリエイターとの継続的な繋がり
  - **次回集客サイクル**: Experience Circle での価値体験が新しい Experience への参加動機を創出
  - **クリエイター関係深化**: アーティストとファンの持続的な関係構築
- **クリエイター支援**: アーティストの持続可能なキャリア構築支援機能

## ユーザーロール定義

### Organization 管理者（Organization Admin）
- **権限**: Organization 情報管理、Experience 作成・編集・削除、売上確認、スタッフ管理
- **責務**: Organization 全体の運営と Experience 戦略の決定
- **認証**: WorkOS 経由の SSO、Enterprise セキュリティ準拠

### Experience マネージャー（Experience Manager）
- **権限**: 担当 Experience の作成・編集、参加者管理、関連コンテンツ管理
- **責務**: 個別 Experience の企画・運営・コミュニティ育成
- **認証**: Organization 配下のアカウント、適切な権限分離

### エンドユーザー（End User）
- **権限**: Experience 検索・予約・体験、関連コンテンツ閲覧、Experience Circle 参加
- **責務**: 予約ルールの遵守、Experience Circle 貢献、体験の楽しみ
- **認証**: Auth0 による認証、簡単なサインアップ・ソーシャルログイン対応

### システム管理者（System Admin）
- **権限**: 全システム監視・管理、Organization 承認・停止、プラットフォーム運営
- **責務**: システム全体の安定運用・セキュリティ維持・ビジネス成長支援

## ビジネスルール

### Experience 予約ルール
1. **予約期限**: Experience 開始24時間前まで予約可能（Organization が設定可能）
2. **キャンセル期限**: Experience 開始48時間前まで無料キャンセル可能
3. **定員管理**: 定員制 Experience は超過時に待機リスト、キャンセル時自動繰り上げ
4. **体験タイプ対応**: 日時指定・期間指定など多様な Experience タイプに対応

### 関連コンテンツアクセスルール
1. **Public コンテンツ**: 誰でも閲覧可能、Experience の魅力を伝える
2. **チケット購入済み**: 予約完了後に閲覧可能、事前準備・期待値向上
3. **体験済み**: QR コード入場記録後に閲覧可能、After 体験・Experience Circle 参加
4. **拡張性**: 将来的な条件追加に対応できる柔軟な権限システム

### Organization・Enterprise ルール
1. **SSO 必須**: WorkOS による厳格な認証、Enterprise セキュリティ基準
2. **Multi-tenant**: Organization 間の完全なデータ分離
3. **権限分離**: 管理者・マネージャー・閲覧者など細かい権限設定
4. **アーティスト優先**: 料金・UI・機能すべてでクリエイター利益を最優先

### データ保持・プライバシールール
1. **個人データ**: GDPR 準拠、エンドユーザーの匿名性保護
2. **体験履歴**: ユーザー同意のもと長期保持、パーソナライゼーション活用
3. **Organization データ**: Enterprise 要件に応じた保持期間設定
4. **Experience Circle データ**: After 体験後のコンテンツアクセス履歴・リテンション分析

## 非機能要件

### パフォーマンス
- **応答時間**: API レスポンス時間 200ms 以内（95パーセンタイル）
- **同時接続**: 最大1,000同時ユーザーに対応
- **可用性**: 99.9% のアップタイム目標

### セキュリティ
- **認証**: JWT ベースの認証システム
- **暗号化**: 通信はHTTPS、機密データはAES-256で暗号化
- **監査**: 全ての重要な操作をログ記録

### 拡張性
- **水平拡張**: マイクロサービス アーキテクチャによる独立したスケーリング
- **データベース**: 読み取り専用レプリカによる負荷分散
- **CDN**: 静的コンテンツの高速配信

## データモデル要件

### 主要エンティティ
1. **Organization（組織）**: Enterprise エンティティ、WorkOS SSO 対応
2. **Experience（体験）**: LBE コンテンツの核、多様な体験タイプ対応
3. **User（ユーザー）**: エンドユーザー（プラットフォーム一意ID）と管理ユーザー（Organization 所属）
4. **Booking（予約）**: Experience 予約・決済・入場記録
5. **ExperienceAssets（関連コンテンツ）**: Before/After コンテンツ、アクセス権限管理

### リレーションシップ
- Organization 1:N Experience（組織は複数の Experience を運営）
- Organization 1:N OrgUser（組織には複数の管理ユーザー）
- Experience 1:N Booking（Experience には複数の予約）
- Experience 1:N ExperienceAssets（Experience には複数の関連コンテンツ）
- User 1:N Booking（エンドユーザーは複数の Experience を予約）

## API設計要件

### REST API エンドポイント設計
- **RESTful設計**: リソース指向のURL設計
- **バージョニング**: APIバージョン管理（/api/v1/）
- **レート制限**: 悪用防止のためのレート制限実装

### tRPC エンドポイント設計
- **型安全性**: TypeScript による型安全なAPI通信
- **リアルタイム**: WebSocket を使った即時更新機能
- **キャッシュ**: 適切なキャッシュ戦略による性能向上

## テスト要件

### 単体テスト
- **カバレッジ**: 90% 以上のコードカバレッジ
- **ビジネスロジック**: 全てのビジネスルールの網羅的テスト
- **エラーハンドリング**: 異常系パターンの包括的テスト

### 統合テスト
- **API テスト**: 全エンドポイントの機能テスト
- **データベース**: データ整合性とトランザクション処理のテスト
- **外部サービス**: 決済システムとの連携テスト

### E2Eテスト
- **ユーザーシナリオ**: 主要な業務フローの自動テスト
- **ブラウザ対応**: 主要ブラウザでの動作確認
- **モバイル対応**: レスポンシブデザインの確認

## 運用要件

### モニタリング
- **アプリケーション監視**: レスポンス時間、エラー率の監視
- **インフラ監視**: CPU、メモリ、ディスク使用率の監視
- **ビジネス監視**: 予約数、売上、ユーザー行動の分析

### バックアップ・災害復旧
- **データバックアップ**: 日次自動バックアップ
- **災害復旧**: 24時間以内の復旧目標（RTO: 24h、RPO: 1h）
- **冗長化**: 複数リージョンでの冗長構成

## コンプライアンス要件

### データ保護法対応
- **GDPR**: EU居住者の個人データ保護
- **個人情報保護法**: 日本の個人情報保護法令遵守
- **PCI DSS**: 決済情報の安全な取り扱い

### アクセシビリティ
- **WCAG 2.1**: レベルAA準拠のアクセシブルな設計
- **多言語対応**: 日本語・英語の多言語対応
- **モバイル対応**: レスポンシブデザインによる全デバイス対応

## 開発時の注意事項

### 実装優先度
1. **MVP機能**: 組織登録、イベント作成、基本的な予約機能
2. **決済機能**: 安全で信頼性の高い決済処理
3. **通知機能**: ユーザーエクスペリエンス向上のための通知システム
4. **分析機能**: ビジネス成長のためのデータ分析機能

### 技術的制約
- **技術スタック**: TypeScript、tRPC、Temporal、Next.js の使用
- **アーキテクチャ**: オニオンアーキテクチャ + 関数型プログラミング
- **エラーハンドリング**: neverthrow の Result 型による統一的なエラー処理

### ビジネス制約
- **予算制約**: 開発・運用コストの最適化
- **時間制約**: MVP リリースまでのスケジュール管理
- **リーガルリスク**: 法的要件の確実な実装

この指示書は、Alllbe プロジェクトの全ての開発・設計判断の基準となります。実装時は常にこれらのビジネス要件を満たすことを確認してください。